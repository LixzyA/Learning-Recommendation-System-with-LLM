<!DOCTYPE html>
<html lang="en">
<head>
<title>Home</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
body {font-family: "Lato", sans-serif}
/* Hide the other input by default */
#otherInputGroup {
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  transition: all 0.3s ease-in-out;
}

#otherInputGroup.show {
  max-height: 100px; /* Adjust based on your needs */
  opacity: 1;
  margin-top: 10px;
}

#results {
    display: none;
    margin-top: 20px;
}
</style>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-black w3-card">
    <a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large">HOME</a>
	<a href="/profile" class="w3-padding-large w3-hover-red w3-hide-small w3-right">{{username}}</a>
	<form action="logout" method="post">
		<input type="hidden" name="name" value="value" /> 
		<a onclick ="this.parentNode.submit();" class="w3-padding-large w3-hover-red w3-hide-small w3-right">Logout</a>
	</form>
  </div>
</div>

<!-- Navbar on small screens (remove the onclick attribute if you want the navbar to always show on top of the content when clicking on the links) -->
<div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-medium w3-top" style="margin-top:46px">
  <a href="#" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">Home</a>
  <a href="profile" class="w3-bar-item w3-button w3-padding-large" onclick="myFunction()">{{username}}</a>
</div>

<!-- Page content -->
<div class="w3-content" style="max-width:2000px;margin-top:46px">


  <!-- The Band Section -->
  <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px" id="band">
    <h2 class="w3-wide">Personal Learning Recommendation System</h2>
    <p class="w3-opacity"><i>by 董贶昌 18202120235</i></p>
    <div class="w3-row w3-padding-32">

      <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <form class="bg-white p-4 rounded shadow-sm" onsubmit="handleSubmit(event)">
                    <div class="mb-4">
                        <label for="styledDropdown" class="form-label fw-bold text-primary">Select an option</label>
                        <select 
                            id="styledDropdown" 
                            class="form-select form-select-lg"
                            onchange="checkOther(this)"
                        >
                            <option value="">Choose...</option>
                            <option value="python">Python</option>
                            <option value="Machine Learning">Machine Learning</option>
                            <option value="others">Others</option>
                        </select>
                    </div>

                    <div id="otherInputGroup">
                        <input 
                            type="text" 
                            id="otherInput" 
                            class="form-control form-control-lg"
                            placeholder="Please specify..."
                        >
                        <div class="form-text text-muted">Type your Query here</div>
                    </div>
                    <div class="d-grid gap-2 mt-4">
                      <button type="submit" id="submitBtn" class="btn btn-primary btn-lg">
                          <i class="bi bi-search me-2"></i>Search
                      </button>
                  </div>
                </form>
                <div id="results" class="bg-white p-4 rounded shadow-sm mt-4">
                  <h5 class="mb-3">Search Results</h5>
                  <div id="resultsContent"></div>
              </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function checkOther(select) {
            const otherInputGroup = document.getElementById('otherInputGroup');
            const otherInput = document.getElementById('otherInput');
            
            if (select.value === 'others') {
                otherInputGroup.classList.add('show');
                otherInput.required = true;
            } else {
                otherInputGroup.classList.remove('show');
                otherInput.required = false;
                otherInput.value = '';
            }
        }
    </script>
    </div>
  </div>
</div>

<script>

// Used to toggle the menu on small screens when clicking on the menu button
function myFunction() {
  var x = document.getElementById("navDemo");
  if (x.className.indexOf("w3-show") == -1) {
    x.className += " w3-show";
  } else { 
    x.className = x.className.replace(" w3-show", "");
  }
}
async function handleSubmit(event) {
  event.preventDefault();
  const submitBtn = document.getElementById('submitBtn');
  const resultsDiv = document.getElementById('results');
  const dropdown = document.getElementById('styledDropdown');
  const otherInput = document.getElementById('otherInput');
  
  // Get the final value
  const selectedValue = dropdown.value === 'others' 
      ? otherInput.value 
      : dropdown.options[dropdown.selectedIndex].text;

  try {
      // Show loading state
      submitBtn.innerHTML = `
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          Searching...
      `;
      submitBtn.disabled = true;

      // Simulate API call (replace with actual fetch to your endpoint)
      const response = await fetch(`http://localhost:1234/search?query=${encodeURIComponent(selectedValue)}`);
      
      if (!response.ok) throw new Error('Network response was not ok');
      
      const searchResults = await response.json();
      resultsDiv.style.display = 'block';
      // Display results
      const data = searchResults.results.objects
      console.log(data)
      const message = searchResults.message.split(': ')[1]; // Extracts "Python" from "Searching for: Python"

      document.getElementById('resultsContent').innerHTML = `
          <p class="text-success">Found ${data.length} results for "${message}"</p>
          <div class="list-group">
              ${data.slice(0, 5).map(item => `
                  <div class="list-group-item">
                      <h6>Name: ${item.properties.name}</h6>
                      <p>File Type: ${item.properties.file_type}</p>
                      <p>Language: ${item.properties.language}</p>
                      <p>Score: ${item.metadata.score.toFixed(2)}</p>
                  </div>
              `).join('')}
          </div>
      `;
      
  } catch (error) {
      resultsDiv.style.display = 'block';
      document.getElementById('resultsContent').innerHTML = `
          <div class="alert alert-danger">
              Error: ${error.message}
          </div>
      `;
  } finally {
      // Reset button
      submitBtn.innerHTML = `<i class="bi bi-search me-2"></i>Search`;
      submitBtn.disabled = false;
  }
}
</script>

</body>

</html>
